initializeApp または applySettings
	applyConfig
		setGraph1Type
			setGraphType
				initPanel
					initWaterfallPanel
						Plotly.newPlot()	グラフを新規作成
				updateAllPanelVisibility
					Plotly.Plots.resize()	要素サイズに合わせる
		setGraph2Type
			setGraphType
		Plotly.relayout()	軸範囲を設定

--- START ---

resetAxes
	Plotly.restyle()	周波数軸を更新
start
	loop
		updatePanel
			updateWaterfall
				Plotly.react()	データのみ更新





Plotly.js v3.3.0についての質問です。

1.Plotly.newPlotでグラフを作ります。
        const trace = {
            type: "scatter3d",
            mode: "lines",
            x: [],
            y: [],
            z: [],
            showlegend: false
        };
        const layout = {
            title: { text: "Waterfall" },
            scene: {
                xaxis: { title: { text: "Frequency [Hz]" } },
                yaxis: { title: { text: "Time" } },
                zaxis: { title: { text: "Amplitude" } },
                camera: {
                    eye: { x: 1.6, y: -1.8, z: 1.2 }  // 斜め上から
                }
            },
            uirevision: true,
            showlegend: false,
            margin: { t: 20, l: 0, r: 0, b: 0 }
        };
        Plotly.newPlot(
            panel.divId, 
            [trace], 
            layout, 
            { responsive: true }
        );

2.Plotly.Plots.resizeで要素サイズに合わせます。
3.Plotly.relayoutで各軸の表示範囲を固定します。

        const layoutUpdate = {
            "scene.xaxis.autorange": false,
            "scene.xaxis.range": FIXED_FREQ_RANGE,
            "scene.zaxis.autorange": false,
            "scene.zaxis.range": FIXED_AMP_RANGE
        };
	Plotly.relayout(panel.divId, layoutUpdate);

4.次に、requestAnimationFrameを使ったループに入り、Plotly.reactによるデータの更新を行います。

        const traces = panel.waterfallFrames.map((frame, i) => {
            return {
                type: "scatter3d",
                mode: "lines",
                x: freqAxis,
                y: Array(freqAxis.length).fill(i),
                z: frame,
                line: {
                    width: 2,
                    color: frame,                // ← 振幅で色を決める
                    colorscale: "Jet"        // ← spectrogramと同系色
                },
                showlegend: false
            };
        });

        const currentLayout = document.getElementById(panel.divId).layout;
        currentLayout.uirevision = true;
        Plotly.react(panel.divId, traces, currentLayout);

5.ループ中はユーザーによるui操作が入ります。

修正してみました。
問題点があれば指摘してください。

currentLayout をしているのなら、 currentLayout.uirevision = true; をする必要がないように感じます。
このように設定する理由は何ですか？

















Plotly.js v3.3.0についての質問です。
以下の機能についての紹介と違いの説明をしてください。同類の機能があれば紹介してください。
Plotly.newPlot
Plotly.Plots.resize
Plotly.relayout
Plotly.restyle
Plotly.react


initWaterfallPanel
Plotly.newPlot(

applyConfig
Plotly.relayout

initWaterfallPanel
  Plotly.newPlot(

updateAllPanelVisibility
Plotly.Plots.resize(div);

--- START

updateWaterfall
 Plotly.react(


--------------

Plotly.js v3.3.0を使用しています。グラフのデータをrequestAnimationFrameで定期的に更新しながら表示するプログラムを作りたいと考えています。

概ね以下に示したコードのような流れで実装しています。
requestAnimationFrameで繰り返し更新している間はグラフ操作ができません。また軸の範囲設定も反映されていません。
グラフのUIは表示中に操作したいので困っています。問題の原因と解決方法を教えてください。

なお、下記のコードは概略です。グラフの種類を変更する機能が必要なので以下のような流れにしています。



# プログラムの概略

// 軸の範囲を設定
Plotly.relayout(panel.divId, {
                    "scene.xaxis.autorange": auto,
                    "scene.xaxis.range": FIXED_FREQ_RANGE,
                    "scene.zaxis.autorange": auto,
                    "scene.zaxis.range": FIXED_AMP_RANGE
                });


// グラフを作成

const trace = {
    type: "scatter3d",
    mode: "lines",
    x: [],
    y: [],
    z: [],
    showlegend: false
};

Plotly.newPlot(
    panel.divId, 
    [trace], 
    {
            title: { text: "Waterfall" },
            scene: {
                xaxis: { title: { text: "Frequency [Hz]" } },
                yaxis: { title: { text: "Time" } },
                zaxis: { title: { text: "Amplitude" } },
                camera: {
                    eye: { x: 1.6, y: -1.8, z: 1.2 }  // 斜め上から
                }
            },
            uirevision: true,
            showlegend: false,
            margin: { t: 20, l: 0, r: 0, b: 0 }
        }, 
    { responsive: true }
);

// グラフのデータのみ更新
// updateWaterfallで定期的に更新を繰り返す

Plotly.react(panel.divId, {
                type: "scatter3d",
                mode: "lines",
                x: freqAxis,
                y: Array(freqAxis.length).fill(i),
                z: frame,
                line: {
                    width: 2,
                    color: frame,                // ← 振幅で色を決める
                    colorscale: "Jet"        // ← spectrogramと同系色
                },
                showlegend: false
            });








